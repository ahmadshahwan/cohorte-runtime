from cohorte.composer.core.events import AgentEvent, FactoryEvent, Action

rule "give-agent-to-instantiate":
    when:
        $event := AgentEvent(kind == AgentEvent.READY)

    then:
        print("Agent {0} is ready".format($event.isolate))
        enqueue(Action($event.isolate, "Instantiate",
                       get_waiting($event.isolate)))
        forget $event

rule "agent-lost":
    when:
        $event := AgentEvent(kind == AgentEvent.LOST)

    then:
        print("Agent {0} lost".format($event.isolate))
        forget $event


rule "factory ready":
    when:
        $event := FactoryEvent(kind == AgentEvent.READY)

    then:
        print("Factory {0} ready on {1}".format($event.factory, $event.isolate))
        enqueue(Action($event.isolate, "Instantiate",
                       get_waiting($event.isolate, $event.factory)))

        # Forget the event
        forget $event

rule "factory-lost":
    when:
        $event := FactoryEvent(kind == AgentEvent.LOST)

    then:
        print("Factory {0} lost on {1}".format($event.factory, $event.isolate))
        factory_lost($event.isolate, $event.factory)
        forget $event
